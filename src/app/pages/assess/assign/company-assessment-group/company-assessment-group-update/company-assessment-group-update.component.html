<nl-spinner [name]="spinnerName"></nl-spinner>
<div class="mt-3 row flex-column">
  <div class="d-flex mb-2">
    <strong class="col mb-3"
      >{{ this.editForm.get('id')?.value ? 'Edit' : 'Add' }} Assign Assessment Group</strong
    >
    <!-- TODO: fix the button -->
    <div class="d-flex gap-2">
      <button type="button" class="p-button" (click)="save()">Save</button>
      <button type="button" class="p-button" (click)="goBack()">Cancel</button>
      <button
        type="button"
        class="p-button"
        (click)="downloadCredits()"
        *ngIf="this.editForm.get('id')?.value">
        Download Credits
      </button>
    </div>
  </div>
  <ng-container [formGroup]="editForm">
    <div class="col">
      <div class="row">
        <div class="col">
          <div class="nl-card nl-border nl-border-1">
            <div class="row mb-3 p-fluid gy-3">
              <div class="col-6" [hidden]="!this.editForm.get('id')!.value">
                <label class="d-block" for="id">Id</label>
                <input type="text" formControlName="id" id="id" class="p-inputtext p-disabled" />
              </div>
              <div class="col-6">
                <label class="d-block" for="companyId">Company</label>
                <p-dropdown
                  [attr.id]="'parent'"
                  formControlName="companyId"
                  [options]="companies"
                  placeholder="Select Company"></p-dropdown>
              </div>
              <div class="col-6">
                <label class="d-block" for="assessment">Assessment</label>
                <p-dropdown
                  [attr.id]="'parent'"
                  formControlName="assessmentGroupId"
                  [options]="assessments"
                  [disabled]="this.editForm.get('id')!.value"
                  placeholder="Select Assessment"></p-dropdown>
              </div>
              <div class="col-6">
                <label class="d-block" for="assessment">Assessment Date</label>
                <p-calendar
                  id="assessment-date"
                  dateFormat="yy-mm-dd"
                  formControlName="scheduleDate"
                  [showIcon]="true"></p-calendar>
              </div>

              <div class="col-6">
                <label class="d-block" for="time-limit">Time Limit (in minutes)*</label>
                <input
                  type="text"
                  formControlName="timeLimit"
                  id="time-limit"
                  class="p-inputtext" />
              </div>
              <div class="col-6">
                <label class="d-block" for="total-credits">Total Assessment*</label>
                <input
                  type="text"
                  formControlName="totalCredits"
                  id="total-credits"
                  class="p-inputtext" />
              </div>
              <ng-container *ngIf="!!this.editForm.get('id')?.value">
                <div class="col-6">
                  <label class="d-block" for="available-credits">Avaliable Credits*</label>
                  <input
                    type="text"
                    formControlName="availableCredits"
                    id="available-credits"
                    class="p-inputtext p-disabled" />
                </div>
                <div class="col-6">
                  <label class="d-block" for="used-credits">Used Credits*</label>
                  <input
                    type="text"
                    formControlName="usedCredits"
                    id="used-credits"
                    class="p-inputtext p-disabled" />
                </div>
                <div class="col-6">
                  <label class="d-block" for="allocated-credits">Allocated Credits*</label>
                  <input
                    type="text"
                    formControlName="allocatedCredits"
                    id="allocated-credits"
                    class="p-inputtext p-disabled" />
                </div>
              </ng-container>
              <div class="col-6">
                <label class="d-block" for="valid-from">Valid From</label>
                <p-calendar
                  id="valid-from"
                  dateFormat="yy-mm-dd"
                  formControlName="validFrom"
                  [showIcon]="true"></p-calendar>
              </div>
              <div class="col-6">
                <label class="d-block" for="valid-to">Valid To</label>
                <p-calendar
                  id="valid-to"
                  dateFormat="yy-mm-dd"
                  formControlName="validTo"
                  [showIcon]="true"></p-calendar>
              </div>

              <div class="col-6" [hidden]="!this.editForm.get('isBranch')!.value">
                <label class="d-block" for="branchId">Branch</label>
                <p-dropdown
                  [attr.id]="'parent'"
                  formControlName="branchId"
                  [options]="branches"
                  placeholder="Select Branch"></p-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-container [formGroup]="individualEditForm" *ngIf="this.editForm.get('id')?.value">
    <div class="mt-4">
      <h3>Individual</h3>
    </div>
    <div class="col">
      <div class="row">
        <div class="col">
          <div class="nl-card nl-border nl-border-1">
            <div class="row mb-3 p-fluid">
              <div class="col-6">
                <label class="d-block" for="generateUrl">Generate URL</label>
                  <input
                    type="text"
                    formControlName="generateUrl"
                    id="generateUrl"
                    class="p-inputtext" />
              </div>
              <div class="col-6">
                <label class="d-block" for="creditCode">Credit Code</label>
                  <input
                    type="text"
                    formControlName="creditCode"
                    id="creditCode"
                    class="p-inputtext" />
              </div>
            </div>
            <div class="row mb-3 p-fluid">
              <div class="col-6">
                <label class="d-block" for="email">Email</label>
                  <input
                    type="text"
                    formControlName="email"
                    id="email"
                    class="p-inputtext"
                    [ngClass]="{'ng-invalid ng-dirty': individualEditForm.get('email')?.invalid }" />
              </div>
              <div class="col-6">
                <label class="d-block" for="contactNumber">Contact Number <span class="fst-italic">(Please enter your WhatsApp contact number)</span></label>
                  <input
                    type="number"
                    formControlName="contactNumber"
                    id="contactNumber"
                    class="p-inputtext"
                    [ngClass]="{'ng-invalid ng-dirty': individualEditForm.get('contactNumber')?.invalid }" />
              </div>
            </div>
            <div class="row mb-3 p-fluid">
              <div class="col-6 d-flex flex-column gap-2">
                <div> Send Report to </div>
                <div class="d-flex gap-4">
                  <div class="d-flex gap-1">
                    <input type="radio" id="institute" name="sendReportTo" value="INSTITUTE" formControlName="sendReportTo">
                    <label for="institute">Institute</label>
                  </div>
                  <div class="d-flex gap-1">
                    <input type="radio" id="student" name="sendReportTo" value="STUDENT" formControlName="sendReportTo"/>
                    <label for="student">Student</label>
                  </div>
                  <div class="d-flex gap-1">
                    <input type="radio" id="both" name="sendReportTo" value="STUDENT_N_INSTITUTE" formControlName="sendReportTo" />
                    <label for="both">Both</label>
                  </div>
                </div>
              </div>
              <div class="col-6 d-flex flex-column">
                <div class="d-flex gap-3 h-32 form-check">
                  <div class="d-flex gap-1">
                    <input type="checkbox" formControlName="emailReport"/>
                    <label for="">Email Report</label>
                  </div>
                  <div class="d-flex gap-1">
                    <input type="checkbox" formControlName="embedCreditCode"/>
                    <label for="">Generate Link Via Embedded Credit Code</label>
                  </div>
                  <div class="d-flex gap-1">
                    <input type="checkbox" formControlName="sendSms"/>
                    <label for="">Send via Message/WhatsApp</label>
                  </div>
                </div>
                <div class="d-flex gap-2 mt-2">
                    <button class="p-button justify-content-center" (click)="generateLink()">Generate Link</button>
                </div>
              </div>
            </div>
          </div>
          <!--card end-->
        </div>
      </div>
    </div>
  </ng-container>
  <ng-container [formGroup]="bulkEditForm" *ngIf="this.editForm.get('id')?.value">
    <div class="mt-4">
      <h3>Bulk</h3>
    </div>
    <div class="col">
      <div class="row">
        <div class="col">
          <div class="nl-card nl-border nl-border-1">
            <div class="row mb-3 p-fluid">
              <div class="col-6">
                <label class="d-block" for="parent">Credits</label>
                  <input
                    type="text"
                    formControlName="credits"
                    id="email"
                    class="p-inputtext" />
                </div>
                <div class="col-6 d-flex flex-column gap-2">
                  <div class="d-flex gap-3 form-check">
                    <div class="d-flex gap-1">
                      <input type="checkbox" formControlName="emailReport"/>
                      <label for="">Email Report</label>
                    </div>
                    <div class="d-flex gap-1">
                      <input type="checkbox" formControlName="embedCreditCode"/>
                      <label for="">Generate Link Via Embedded Credit Code</label>
                    </div>
                  </div>
                  <div class="d-flex mt-1 gap-2">
                      <button class="p-button justify-content-center" (click)="downloadTemplate()">Download Template</button>
                      <button class="p-button justify-content-center" (click)="uploadUserAndEmailLinks()">Upload User & Email Links</button>
                      <button class="p-button justify-content-center" (click)="downloadBulkLinks()">Download Links</button>
                  </div>
                </div>
            </div>
            <div class="row mb-3 p-fluid">
              <div class="col-6 d-flex flex-column gap-2">
                <div> Send Report to </div>
                <div class="d-flex gap-4">
                  <div class="d-flex gap-1">
                    <input type="radio" id="institute" name="bulkSendReportTo" value="INSTITUTE" formControlName="sendReportTo">
                    <label for="institute">Institute</label>
                  </div>
                  <div class="d-flex gap-1">
                    <input type="radio" id="student" name="bulkSendReportTo" value="STUDENT" formControlName="sendReportTo"/>
                    <label for="student">Student</label>
                  </div>
                  <div class="d-flex gap-1">
                    <input type="radio" id="both" name="bulkSendReportTo" value="STUDENT_N_INSTITUTE" formControlName="sendReportTo" />
                    <label for="both">Both</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
            <!--card end-->
          </div>
        </div>
      </div>
  </ng-container>
</div>
